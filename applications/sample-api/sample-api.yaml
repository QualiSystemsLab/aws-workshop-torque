spec_version: 1
kind: application
inputs:
- API_PORT: 3001
- AZURE_VM_SIZE: Basic_A1
- AWS_INSTANCE_TYPE: t2.micro
- RELEASE_NUMBER: none
- API_BUILD_NUMBER: none
- IAM_ROLE: none

infrastructure:
  connectivity:
    internal:
    - port_info:
        port: 3000
        ingress-healthcheck:                  
            healthy-threshold: 5
            interval: 30
            path: /
            status-codes: 200-299
            timeout: 5
            unhealthy-threshold: 2
  compute:
    spec:      
      azure:
        vm_size: $AZURE_VM_SIZE
      aws:
        instance_type: $AWS_INSTANCE_TYPE
  permissions:
      aws:
        iam_instance_profile: $IAM_ROLE
        
configuration:
  start:
    script: sample-api-command.sh
  initialization:
    script: sample-api.sh
  healthcheck:
    wait_for_ports: ALL
    timeout: 360

source:
  image:
    docker_image:
    - name: ubuntu
      tag: 18.04
    ami:
      - id: ami-0747bdcabd34c712a
        region: us-east-1
        username: ubuntu
  os_type: linux

debugging: 
  connection_protocol: SSH
 
